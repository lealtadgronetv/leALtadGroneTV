<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extractor de enlaces M3U8</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h2>Extractor de enlaces HLS (M3U8)</h2>
    <input type="text" id="urlInput" placeholder="Ingrese la URL">
    <button onclick="startExtraction()">Iniciar extracción</button>
    <table>
        <thead>
            <tr>
                <th>Type</th>
                <th>Filename</th>
                <th>Source</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody id="resultTableBody"></tbody>
    </table>

    <script>
        let intervalId;

        function startExtraction() {
            const url = document.getElementById("urlInput").value;
            if (!url) {
                alert("Ingrese una URL válida");
                return;
            }
            extractLinks(url);
            clearInterval(intervalId);
            intervalId = setInterval(() => extractLinks(url), 10000);
        }

        async function extractLinks(url) {
            try {
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                const text = data.contents;

                const regex = /(https?:\/\/[^\s]+\.m3u8)/g;
                const matches = text.match(regex);
                const resultTableBody = document.getElementById("resultTableBody");
                resultTableBody.innerHTML = "";

                if (matches) {
                    matches.forEach(link => {
                        const filename = link.split('/').pop();
                        const source = new URL(link).hostname;
                        const timestamp = new Date().toLocaleString();

                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>HLS</td>
                            <td>${filename}</td>
                            <td>${source}</td>
                            <td>${timestamp}</td>
                        `;
                        resultTableBody.appendChild(row);
                    });
                } else {
                    resultTableBody.innerHTML = "<tr><td colspan='4'>No se encontraron enlaces M3U8</td></tr>";
                }
            } catch (error) {
                alert("Error al obtener la información. Verifique la URL e intente de nuevo.");
                console.error("Error de solicitud:", error);
            }
        }
    </script>
</body>
</html>
